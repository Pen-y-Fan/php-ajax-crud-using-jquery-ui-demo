<!doctype html>
<html lang="en">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BmbxuPwQa2lc/FVzBcNJ7UAyJxM6wuqIj61tLrc4wSX0szH/Ev+nYRRuWlolflfl" crossorigin="anonymous">

    <title>PHP Ajax Crud using JQuery UI Dialog Box</title>
    <link rel="stylesheet" href="./css/jquery-ui.css">

</head>
<body>
<div class="container">

    <h1 class="text-center mb-5">PHP Ajax Crud using JQuery UI Dialog</h1>

    <div class="row">
        <div class="col-sm-1 offset-sm-11 mb-3">
            <button type="button" name="add" id="add" class="btn btn-success">Add</button>
        </div>
    </div>
    <div class="table-responsive" id="user_data"></div>
</div>

<div id="user_dialog" title="Add Data">
    <form method="post" id="user_form">
        <div class="form-group">
            <label for="first_name">Enter First Name</label>
            <input type="text" name="first_name" id="first_name" class="form-control" />
            <span id="error_first_name" class="text-danger"></span>
        </div>
        <div class="form-group">
            <label for="last_name">Enter Last Name</label>
            <input type="text" name="last_name" id="last_name" class="form-control"/>
            <span id="error_last_name" class="text-danger"></span>
        </div>
        <div class="form-group">
            <input type="hidden" name="action" id="action" value="insert"/>
            <input type="hidden" name="hidden_id" id="hidden_id"/>
            <input type="submit" name="form_action" id="form_action" class="btn btn-info" value="Insert"/>
        </div>
    </form>
</div>

<div id="action_alert" title="Action">

</div>

<div id="delete_confirmation" title="Confirmation">
    <p>Are you sure you want to Delete this data?</p>
</div>

<script src="./js/jquery-3.5.1.min.js"></script>
<script src="./js/jquery-ui.js"></script>
<script>
  $(document).ready(function () {

    load_data();

    function load_data() {
      $.ajax({
        url: "fetch.php",
        method: "POST",
        success: function (data) {
          $('#user_data').html(data);
        }
      });
    }

    $("#user_dialog").dialog({
      autoOpen: false,
      width: 400
    });

    $('#add').click(function () {
      $('#user_dialog').attr('title', 'Add Data');
      $('#action').val('insert');
      $('#form_action').val('Insert');
      $('#user_form')[0].reset();
      $('#form_action').attr('disabled', false);
      $("#user_dialog").dialog('open');
    });

    $('#user_form').on('submit', function (event) {
      event.preventDefault();
      var error_first_name = '';
      var error_last_name = '';
      if ($('#first_name').val() == '') {
        error_first_name = 'First Name is required';
        $('#error_first_name').text(error_first_name);
        $('#first_name').css('border-color', '#cc0000');
      } else {
        error_first_name = '';
        $('#error_first_name').text(error_first_name);
        $('#first_name').css('border-color', '');
      }
      if ($('#last_name').val() == '') {
        error_last_name = 'Last Name is required';
        $('#error_last_name').text(error_last_name);
        $('#last_name').css('border-color', '#cc0000');
      } else {
        error_last_name = '';
        $('#error_last_name').text(error_last_name);
        $('#last_name').css('border-color', '');
      }

      if (error_first_name != '' || error_last_name != '') {
        return false;
      } else {
        $('#form_action').attr('disabled', 'disabled');
        var form_data = $(this).serialize();
        $.ajax({
          url: "action.php",
          method: "POST",
          data: form_data,
          success: function (data) {
            $('#user_dialog').dialog('close');
            $('#action_alert').html(data);
            $('#action_alert').dialog('open');
            load_data();
            $('#form_action').attr('disabled', false);
          }
        });
      }

    });

    $('#action_alert').dialog({
      autoOpen: false
    });

    $(document).on('click', '.edit', function () {
      var id = $(this).attr('id');
      var action = 'fetch_single';
      $.ajax({
        url: "action.php",
        method: "POST",
        data: {id: id, action: action},
        dataType: "json",
        success: function (data) {
          $('#first_name').val(data.first_name);
          $('#last_name').val(data.last_name);
          $('#user_dialog').attr('title', 'Edit Data');
          $('#action').val('update');
          $('#hidden_id').val(id);
          $('#form_action').val('Update');
          $('#user_dialog').dialog('open');
        }
      });
    });

    $('#delete_confirmation').dialog({
      autoOpen: false,
      modal: true,
      buttons: {
        Ok: function () {
          var id = $(this).data('id');
          var action = 'delete';
          $.ajax({
            url: "action.php",
            method: "POST",
            data: {id: id, action: action},
            success: function (data) {
              $('#delete_confirmation').dialog('close');
              $('#action_alert').html(data);
              $('#action_alert').dialog('open');
              load_data();
            }
          });
        },
        Cancel: function () {
          $(this).dialog('close');
        }
      }
    });

    $(document).on('click', '.delete', function () {
      var id = $(this).attr("id");
      $('#delete_confirmation').data('id', id).dialog('open');
    });

  });
</script>

</body>
</html>

